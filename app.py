# =======================================================================
# FILE: app.py (LENGKAP DAN SUDAH DIPERBAIKI)
# =======================================================================

# --- PASTIKAN ANDA SUDAH MENGINSTAL LIBRARY INI ---
# Buka terminal dan jalankan:
# pip install Flask flask-cors python-docx
# ---------------------------------------------------

from flask import Flask, request, jsonify, send_file
from flask_cors import CORS
import datetime
from io import BytesIO
from docx import Document
from docx.shared import Pt, Mm
from docx.enum.text import WD_ALIGN_PARAGRAPH
from docx.enum.table import WD_ALIGN_VERTICAL

from docx.shared import Pt, Mm, Inches 
from docx.enum.text import WD_ALIGN_PARAGRAPH
from docx.enum.table import WD_ALIGN_VERTICAL

# --- Inisialisasi Server ---
# INI ADALAH BARIS YANG HILANG ATAU SALAH TEMPAT PADA FILE ANDA
app = Flask(__name__)
CORS(app)
ATURAN_TINGGI_MAKS = 15

ATURAN_LENGKAP_SWP = {
    "A": {
        "PS": { "PS-Default": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] } },
        "BJ": { "BJ-Default": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] } },

        "SPU": { 
            "SPU Skala Kota (SPU-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "SPU Skala Kecamatan (SPU-2)": { "40-100": [80, 3.2, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kecamatan (SPU-2) tod-2": { "40-100": [80, 3.2, 10], "101-200": [80, 4, 10], "201-400": [80, 4, 10], "401-1000": [70, 4.2, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3)": { "40-100": [80, 2.8, 10], "101-200": [80, 2.8, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3) k-3": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
        }, 
        "HanKam": { "HanKam-1": { "40-100": [40, 0.8, 40], "101-200": [40, 0.8, 40], "201-400": [35, 0.7, 40], "401-1000": [30, 0.6, 40], ">1000": [30, 0.6, 40] } }, 
        "Trans": { "Trans-1": { "40-100": [50, 1.0, 30], "101-200": [50, 1.0, 30], "201-400": [45, 1.0, 30], "401-1000": [40, 1.0, 30], ">1000": [40, 1.0, 30] } }, 
        "RTH": { 
            "Taman Kota (RTH-2)": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] },
            "Taman Kota (RTH-2) Kawasan Malioboro": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] },
            "Taman Kota (RTH-2)Kawasan Sumbu Filosofi": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] },
            "Taman Kecamatan (RTH-3)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kelurahan (RTH-4)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman RW (RTH-5)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7) Kawasan TOD Lempuyangan": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8) Kawasan Malioboro": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8) Kawasan Sumbu Filosofi": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
        },
        "R": { 
            "Perumahan Kepadatan Tinggi (R-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.6, 10], "401-1000": [80, 4.0, 10], ">1000": [80, 4.0, 10] },
            "Perumahan Kepadatan Tinggi (R-2) ": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 3.0, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] },
            "Perumahan Kepadatan Sedang": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 3.2, 10], "401-1000": [80, 3.2, 10], ">1000": [80, 3.2, 10] }
        },
        "CB": { 
            "Cagar Budaya (CB) Kawasan Kotabaru dan TOD Lempuyangan": { "40-100": [60, 1.8, 20], "101-200": [60, 2.4, 20], "201-400": [60, 2.7, 20], "401-1000": [60, 3.0, 20], ">1000": [60, 3.2, 20] }, 
            "Cagar Budaya (CB) TOD Lempuyangan": { "40-100": [70, 2.8, 20], "101-200": [70, 2.8, 20], "201-400": [70, 3.2, 20], "401-1000": [70, 3.2, 20], ">1000": [70, 3.2, 20] }, 
            "Cagar Budaya (CB) Kawasan Malioboro": { "40-100": [80, 3.5, 10], "101-200": [80, 4.0, 10], "201-400": [80, 4.0, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.2, 10] }, 
            "Cagar Budaya (CB) Kawasan KotaBaru": { "40-100": [80, 3.5, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] }
        },
        "K": { 
            "Perdagangan dan Jasa Skala Kota (K-1)": { "40-100": [80, 3.5, 10], "101-200": [80, 4.2, 10], "201-400": [80, 4.8, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 5.0, 10] },
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.8, 10], "101-200": [80, 4.0, 10], "201-400": [80, 4.2, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 5.0, 10] }
        },
        "C": {
             "Campuran Intensitas Menengah/Sedang (C-2) tod-2": {
                 "40-100": [80, 4, 5],
                 "101-200": [80, 4.5, 5],
                 "201-400": [80, 4.8, 10],
                 "401-1000": [80, 5.6, 10],
                 ">1000": [80, 6, 10]
             }
        }
    },
    "B": {
        "PS": { "PS-1": { "40-100": [30, 0.6, 60], "101-200": [30, 0.6, 60], "201-400": [25, 0.6, 60], "401-1000": [25, 0.6, 60], ">1000": [25, 0.6, 60] } },
        "BJ": { "BJ-Default": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] } },
        "K": { 
            "Perdagangan dan Jasa Skala Kota (K-1)": { "40-100": [80, 3.0, 10], "101-200": [80, 3.0, 10], "201-400": [75, 3.0, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 3.5, 10] }, 
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.8, 10], "101-200": [80, 4.0, 10], "201-400": [80, 4.2, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 5.0, 10] } 
        },
        "SPU": { "SPU-1": { "40-100": [60, 2.0, 20], "101-200": [60, 2.0, 20], "201-400": [55, 2.0, 20], "401-1000": [50, 2.0, 20], ">1000": [50, 2.0, 20] } },
        "HanKam": { "HanKam-1": { "40-100": [40, 0.8, 40], "101-200": [40, 0.8, 40], "201-400": [35, 0.7, 40], "401-1000": [30, 0.6, 40], ">1000": [30, 0.6, 40] } }, 
        "Trans": { "Trans-1": { "40-100": [50, 1.0, 30], "101-200": [50, 1.0, 30], "201-400": [45, 1.0, 30], "401-1000": [40, 1.0, 30], ">1000": [40, 1.0, 30] } }, 
        "RTH": { 
            "RTH-4": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }, 
            "RTH-5": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, 
            "RTH-7": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, 
            "RTH-8": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, 
            "RTH-8-+6": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, 
            "RTH-8-+9": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] } 
        },
        "R": { "R-1": { "40-100": [70, 1.4, 20], "101-200": [70, 1.4, 20], "201-400": [65, 1.3, 25], "401-1000": [60, 1.2, 30], ">1000": [50, 1.0, 30] } },
        "CB": { 
            "CB-I-1": { "40-100": [70, 2.8, 20], "101-200": [70, 2.8, 20], "201-400": [70, 3.2, 20], "401-1000": [70, 3.2, 20], ">1000": [70, 3.2, 20] }, 
            "CB-I-1-mod-2": { "40-100": [70, 2.8, 20], "101-200": [70, 2.8, 20], "201-400": [70, 3.2, 20], "401-1000": [70, 3.2, 20], ">1000": [70, 3.2, 20] }, 
            "CB-I-6": { "40-100": [80, 3.5, 10], "101-200": [80, 4.0, 10], "201-400": [80, 4.0, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.2, 10] }, 
            "CB-I-9": { "40-100": [80, 3.5, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] } 
        }
    },

        "B": {
        "PS": {
            "PS-Default": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kecamatan (RTH-3)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kelurahan (RTH-4) Kawasan Penyangga KCB Kraton": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # Menggunakan k-3
             "Taman RW (RTH-5)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
             "Pemakaman (RTH-7)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Jalur Hijau (RTH-8)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "CB": {
            "Cagar Budaya (CB) Kawasan Malioboro": { "40-100": [80, 3.5, 10], "101-200": [80, 4, 10], "201-400": [80, 4, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.2, 10] }, # Menggunakan l-6
            "Cagar Budaya (CB) Kawasan Sumbu Filosofi": { "40-100": [80, 3.5, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] } # Menggunakan l-9
        },
        "BJ": {
            "BJ-Default": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] }, # Menggunakan k-3
            "Perumahan Kepadatan Sedang (R-3) Kawasan Penyangga KCB Kraton": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.4, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 2.8, 10] } # Menggunakan k-3
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.5, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] }, # Menggunakan k-3
            "Perdagangan dan Jasa Skala WP (K-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.2, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] } # Menggunakan k-3
        },
        "KT": {
             "KT-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "RTNH": {
             "RTNH-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "SPU Skala Kecamatan (SPU-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }, # Menggunakan k-3
             "SPU Skala Kelurahan (SPU-3) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] } # Menggunakan k-3
        },
        "HanKam": { # Dari tabel terakhir
             "HK-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "Trans": { # Dari tabel terakhir
            "Transportasi (TR) Kawasan Malioboro; Kawasan TOD Tugu": { # Menggunakan l-6, tod-1
                "40-100": [90, 3.5, 5], "101-200": [90, 4.5, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 6.4, 10]
            },
            "Transportasi (TR) Kawasan Sumbu Filosofi; Kawasan TOD Tugu": { # Menggunakan l-9, tod-1
                 "40-100": [80, 3.5, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10]
            }
        },
        "C": { # Dari tabel terakhir
             "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
             "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },

     "C": {
        "PS": {
            "PS-Default": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2) l-1": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] },
            "Taman Kecamatan (RTH-3) l-1": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) k-1": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) k-5": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4) l-1": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4) k-1": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman RW (RTH-5)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman RW (RTH-5) k-5": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7) k-1": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8) l-1": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8) k-1": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
        },
         "CB": {
            "Cagar Budaya (CB) l-1": { "40-100": [60, 1.8, 20], "101-200": [60, 2.4, 20], "201-400": [60, 2.7, 20], "401-1000": [60, 3.0, 20], ">1000": [60, 3.2, 20] },
            "Cagar Budaya (CB) l-1; tod-2": { "40-100": [70, 2.7, 20], "101-200": [70, 2.7, 20], "201-400": [70, 3.2, 20], "401-1000": [70, 3.2, 20], ">1000": [70, 3.2, 20] }
        },
        "BJ": {
            "BJ-Default": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2)": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.6, 10], "401-1000": [80, 4, 10], ">1000": [80, 4, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-1": { "40-100": [70, 2, 10], "101-200": [70, 2.4, 10], "201-400": [70, 2.4, 10], "401-1000": [70, 2.8, 10], ">1000": [70, 2.8, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-5": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.2, 10], "401-1000": [80, 4, 10], ">1000": [80, 4, 10] },
            "Perumahan Kepadatan Tinggi (R-2) tod-2": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 4, 10], "401-1000": [70, 4, 10], ">1000": [70, 4, 10] },
            "Perumahan Kepadatan Sedang (R-3)": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.2, 10], ">1000": [80, 3.2, 10] }
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1)": { "40-100": [80, 3, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) k-1": { "40-100": [80, 3, 5], "101-200": [80, 4.5, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 6, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) tod-2": { "40-100": [80, 3, 5], "101-200": [80, 4.8, 5], "201-400": [80, 5.6, 10], "401-1000": [80, 6.0, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-5": { "40-100": [80, 2.8, 5], "101-200": [80, 2.8, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.2, 10] },
        },
        "KT": {
            "Perkantoran (KT)": { "40-100": [80, 2.8, 5], "101-200": [80, 2.8, 5], "201-400": [80, 3.5, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perkantoran (KT) tod-2": { "40-100": [80, 3, 5], "101-200": [80, 4.0, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 6, 10] },
        },
        "RTNH": {
            "RTNH-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [80, 3.2, 10], "101-200": [80, 3.5, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 4.2, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kota (SPU-1) k-1": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 4.2, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kota (SPU-1) k-5": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 4.2, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kecamatan (SPU-2)": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kecamatan (SPU-2) k-1": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kecamatan (SPU-2) k-3": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kecamatan (SPU-2) k-5": { "40-100": [80, 3.2, 10], "101-200": [80, 3.5, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 4.2, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3)": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3) k-1": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [70, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
        },
        "HanKam": {
             "HK-Default": { "40-100": [80, 3.2, 5], "101-200": [80, 4.0, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] }
        },
        "Trans": {
             "Transportasi (TR) tod-2": { "40-100": [90, 3.2, 5], "101-200": [90, 4.8, 5], "201-400": [90, 5.2, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 6, 10] }
        },
        "C": {
             "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
             "Campuran Intensitas Menengah/Sedang (C-2) tod-2": { "40-100": [80, 3.2, 5], "101-200": [80, 4.8, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 6, 10] }
        }
    },

    # --- DATA SWP D YANG BARU ---
    "D": {
        "PS": {
            "PS-Default": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2) l-5": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] },
            "Taman Kota (RTH-2) Kawasan Malioboro": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] }, # Menggunakan l-6
            "Taman Kota (RTH-2) Kawasan Sumbu Filosofi": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] }, # Menggunakan l-9
            "Taman Kecamatan (RTH-3) l-5": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) Kawasan Malioboro": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # Menggunakan l-6
            "Taman Kelurahan (RTH-4)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman RW (RTH-5)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Pemakaman (RTH-7) l-5": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8) Kawasan Sumbu Filosofi": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] } # Menggunakan l-9
        },
        "CB": {
            "Cagar Budaya (CB) l-4": { "40-100": [70, 1.2, 10], "101-200": [70, 1.2, 10], "201-400": [70, 1.6, 10], "401-1000": [70, 1.6, 10], ">1000": [70, 2.1, 10] },
            "Cagar Budaya (CB) l-5": { "40-100": [80, 2.8, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.2, 10] }, # Ada perbedaan KLB 401-1000 di tabel vs diketik (4 vs 4.2), saya pakai 4.0
            "Cagar Budaya (CB) Kawasan Malioboro": { "40-100": [80, 3.5, 10], "101-200": [80, 4, 10], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.2, 10] }, # Menggunakan l-6
            "Cagar Budaya (CB) Kawasan Sumbu Filosofi": { "40-100": [80, 3.5, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] } # Menggunakan l-9
        },
        "BJ": {
            "BJ-Default": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] }, # Menggunakan k-3
            "Perumahan Kepadatan Sedang (R-3) Kawasan Penyangga KCB Kraton": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.4, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 2.8, 10] } # Menggunakan k-3
        },
        "K": {
             "Perdagangan dan Jasa Skala Kota (K-1) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.5, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] }, # Menggunakan k-3
             "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] } # Tidak ada data
        },
        "KT": {
             "KT-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "RTNH": {
             "RTNH-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "SPU Skala Kecamatan (SPU-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }, # Menggunakan k-3
            "SPU Skala Kelurahan (SPU-3) Kawasan Penyangga KCB Kraton": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] } # Menggunakan k-3
        },
        "HanKam": {
             "HK-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "Trans": {
             "TR-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "C": {
             "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
             "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR DATA SWP D ---
    # --- DATA SWP E YANG BARU ---
    "E": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Perlindungan Setempat (PS) Kawasan Penyangga KCB Kraton": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] } # k-3
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] },
            "Taman Kecamatan (RTH-3)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) Kawasan Penyangga KCB Kraton": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-3
            "Taman Kelurahan (RTH-4) Kawasan Penyangga KCB Kraton": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-3
            "Taman Kelurahan (RTH-4) Kawasan Jetis": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-6
            "Taman RW (RTH-5) Kawasan Malioboro": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # l-6
            "Taman RW (RTH-5) Kawasan Sumbu Filosofi": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # l-9
            "Pemakaman (RTH-7) Kawasan Penyangga KCB Kraton": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-3
            "Jalur Hijau (RTH-8)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8) Kawasan Penyangga KCB Kraton": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-3
            "Jalur Hijau (RTH-8) Kawasan Malioboro; Kawasan TOD Tugu": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # l-6, tod-1
        },
        "CB": {
            "Cagar Budaya (CB) Kawasan Malioboro": { "40-100": [80, 3.5, 10], "101-200": [80, 4, 10], "201-400": [80, 4, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.2, 10] }, # l-6
            "Cagar Budaya (CB) Kawasan Malioboro; Kawasan TOD Tugu": { "40-100": [80, 3.5, 10], "101-200": [80, 4, 10], "201-400": [80, 4.2, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.2, 10] }, # l-6, tod-1
            "Cagar Budaya (CB) Kawasan Sumbu Filosofi": { "40-100": [80, 3.5, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] } # l-9
        },
        "BJ": {
            "BJ-Default": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2)": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.6, 10], "401-1000": [80, 4, 10], ">1000": [80, 4, 10] },
            "Perumahan Kepadatan Tinggi (R-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] }, # k-3
            "Perumahan Kepadatan Tinggi (R-2) Kawasan Jetis": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] }, # k-6
            "Perumahan Kepadatan Sedang (R-3) Kawasan Penyangga KCB Kraton": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.4, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 3.2, 10] } # k-3
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1)": { "40-100": [80, 3.6, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.5, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] }, # k-3
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.2, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] }, # k-3
            "Perdagangan dan Jasa Skala WP (K-2) k-5": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 5], "201-400": [80, 4, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.2, 10] },
        },
         "KT": {
             "Perkantoran (KT) Kawasan Penyangga KCB Kraton": { "40-100": [80, 2.8, 5], "101-200": [80, 2.8, 5], "201-400": [80, 3, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] } # k-3
        },
        "RTNH": {
             "RTNH-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [80, 3.2, 10], "101-200": [80, 3.5, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 4.2, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kota (SPU-1) Kawasan Penyangga KCB Kraton": { "40-100": [80, 2.4, 10], "101-200": [80, 3.5, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 4.8, 10], ">1000": [70, 4.8, 10] }, # k-3
            "SPU Skala Kota (SPU-1) Kawasan Jetis": { "40-100": [80, 2.4, 10], "101-200": [80, 3.5, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 4.8, 10], ">1000": [70, 4.8, 10] }, # k-6
            "SPU Skala Kecamatan (SPU-2) Kawasan Penyangga KCB Kraton": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }, # k-3
            "SPU Skala Kelurahan (SPU-3) Kawasan Penyangga KCB Kraton": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }, # k-3
            "SPU Skala Kelurahan (SPU-3) Kawasan Jetis": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] } # k-6
        },
        "HanKam": {
             "Pertahanan dan Keamanan (HK) Kawasan Jetis": { "40-100": [80, 3.2, 5], "101-200": [80, 3.2, 5], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.8, 10] } # k-6
        },
        "Trans": {
             "Transportasi (TR) Kawasan Malioboro; Kawasan TOD Tugu": { "40-100": [80, 3.5, 5], "101-200": [80, 4.5, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 6.4, 10] } # l-6, tod-1
        },
        "C": {
             "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
             "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR DATA SWP E ---
    # --- DATA SWP F YANG BARU ---
    "F": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Perlindungan Setempat (PS) Kawasan Penyangga KCB Kotagede": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] } # k-2
        },
        "RTH": {
            "Taman Kota (RTH-2) Kawasan Penyangga KCB Kotagede": { "40-100": [30, 0.6, 0], "101-200": [30, 0.6, 0], "201-400": [30, 0.6, 0], "401-1000": [30, 0.6, 0], ">1000": [30, 0.6, 60] }, # KDH >1000=60, sisanya 0 (strip)
            "Taman Kecamatan (RTH-3) Kawasan Penyangga KCB Kotagede": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-2
            "Taman Kecamatan (RTH-3) l-2": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # Kawasan Kotagede
            "Taman Kelurahan (RTH-4) Kawasan Penyangga KCB Kotagede": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-2
            "Taman RW (RTH-5) Kawasan Penyangga KCB Kotagede": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-2
            "Pemakaman (RTH-7) l-2": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # Kawasan Kotagede
            "Pemakaman (RTH-7) Kawasan Penyangga KCB Kotagede": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }, # k-2
            "Jalur Hijau (RTH-8)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "CB": {
            "Cagar Budaya (CB) Kawasan Kotagede": { "40-100": [70, 2.1, 10], "101-200": [70, 2.8, 10], "201-400": [70, 2.8, 10], "401-1000": [70, 3.2, 10], ">1000": [70, 3.5, 10] } # l-2
        },
        "BJ": {
            "BJ-Default": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2) Kawasan Penyangga KCB Kotagede": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] }, # k-2
            "Perumahan Kepadatan Sedang (R-3)": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.2, 10], ">1000": [80, 3.2, 10] }, # (Tabel R-3 tanpa k-2)
            "Perumahan Kepadatan Sedang (R-3) Kawasan Penyangga KCB Kotagede": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.1, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 3.2, 10] } # k-2
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1) Kawasan Penyangga KCB Kotagede": { "40-100": [80, 3, 5], "101-200": [80, 4.0, 5], "201-400": [80, 4.0, 10], "401-1000": [70, 4.8, 10], ">1000": [70, 5.6, 10] }, # k-2
            "Perdagangan dan Jasa Skala Kota (K-1) Kawasan penerapan TPZ bonus": { "40-100": [80, 3.2, 5], "101-200": [80, 4.8, 5], "201-400": [80, 5.2, 10], "401-1000": [70, 5.6, 10], ">1000": [70, 6.4, 10] }, # k-2, b
            "Perdagangan dan Jasa Skala WP (K-2) Kawasan Penyangga KCB Kotagede": { "40-100": [80, 2.8, 5], "101-200": [80, 3.2, 5], "201-400": [80, 4.0, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] }, # k-2
            "Perdagangan dan Jasa Skala WP (K-2) Kawasan penerapan TPZ bonus": { "40-100": [80, 3.2, 5], "101-200": [80, 4.0, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 6, 10] }, # k-2, b
        },
        "KT": {
            "Perkantoran (KT) Kawasan Penyangga KCB Kotagede": { "40-100": [80, 2.8, 5], "101-200": [80, 2.8, 5], "201-400": [80, 2.8, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] } # k-2
        },
        "RTNH": {
             "RTNH-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1) Kawasan Penyangga KCB Kotagede": { "40-100": [80, 3.2, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 4.2, 10], ">1000": [70, 4.8, 10] }, # k-2
            "SPU Skala Kecamatan (SPU-2) Kawasan Penyangga KCB Kotagede": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }, # k-2
            "SPU Skala Kelurahan (SPU-3) Kawasan Penyangga KCB Kotagede": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }, # k-2
        },
        "HanKam": {
             "HK-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "Trans": {
             "TR-Default": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "C": {
             "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
             "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR DATA SWP F ---

    # --- TAMBAHKAN DATA BARU SWP G MULAI DARI SINI ---
    "G": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "RTH": {
            "Taman Kota (RTH-2) I-3": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] },
            "Taman Kecamatan (RTH-3) I-3": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4) I-3": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman RW (RTH-5)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Pemakaman (RTH-7)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Jalur Hijau (RTH-8) I-3": { "40-100": [25, 0.4, 50], "101-200": [25, 0.4, 50], "201-400": [20, 0.3, 60], "401-1000": [20, 0.3, 60], ">1000": [20, 0.3, 60] }
        },
        "CB": {
            "Cagar Budaya (CB) I-3": { "40-100": [70, 0.7, 10], "101-200": [70, 0.7, 10], "201-400": [70, 0.7, 10], "401-1000": [70, 0.7, 10], ">1000": [70, 0.7, 10] }
        },
        "BJ": {
            "Badan Jalan (BJ)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        # Zona lain yang ada di ZONA_OPTIONS (script.js) tapi tidak ada di gambar SWP G
        # Diberi data kosong {} agar program tidak error saat mengambil sub-zona
        "R": {},
        "K": {},
        "SPU": {},
        "HanKam": {},
        "Trans": {},
        "C": {}
    },
    # --- AKHIR DATA BARU SWP G ---

    # --- TAMBAHKAN DATA BARU SWP H MULAI DARI SINI ---
    "H": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Perlindungan Setempat (PS) k-3": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kecamatan (RTH-3) I-4": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) I-7": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) I-9": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4) k-3": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman RW (RTH-5)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Pemakaman (RTH-7) I-7": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7) k-3": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "CB": {
            "Cagar Budaya (CB) I-4": { "40-100": [70, 1.2, 10], "101-200": [70, 1.2, 10], "201-400": [70, 1.6, 10], "401-1000": [70, 1.6, 10], ">1000": [70, 2.1, 10] },
            "Cagar Budaya (CB) I-7": { "40-100": [80, 3.5, 10], "101-200": [80, 3.5, 10], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.2, 10] },
            "Cagar Budaya (CB) I-9": { "40-100": [80, 3.5, 10], "101-200": [80, 3.5, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] }
        },
        "BJ": {
            "Badan Jalan (BJ)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] },
            "Perumahan Kepadatan Sedang (R-3) k-3": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.4, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 2.8, 10] }
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1) k-3": { "40-100": [80, 3.5, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-3": { "40-100": [80, 3.2, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] }
        },
        "KT": {
            "Perkantoran (KT)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "RTNH": {
            "Ruang Terbuka Non Hijau (RTNH)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1) k-3": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.6, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kecamatan (SPU-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "SPU Skala Kelurahan (SPU-3) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }
        },
        "HanKam": {
            "Pertahanan dan Keamanan (HK)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "Trans": {
            "Transportasi (TR)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "C": {
            "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR DATA BARU SWP H ---

    # --- TAMBAHKAN DATA BARU SWP I MULAI DARI SINI ---
    "I": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kecamatan (RTH-3)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) k-3": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4) k-3": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman RW (RTH-5)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Pemakaman (RTH-7)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7) k-3": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7) k-4": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "CB": {
            "Cagar Budaya (CB) I-4": { "40-100": [70, 1.2, 10], "101-200": [70, 1.2, 10], "201-400": [70, 1.6, 10], "401-1000": [70, 1.6, 10], ">1000": [70, 2.1, 10] }
        },
        "BJ": {
            "Badan Jalan (BJ)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2)": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.6, 10], "401-1000": [80, 4, 10], ">1000": [80, 4, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-4": { "40-100": [80, 2.1, 10], "101-200": [80, 2.1, 10], "201-400": [80, 2.1, 10], "401-1000": [80, 2.8, 10], ">1000": [80, 3.2, 10] },
            "Perumahan Kepadatan Sedang (R-3)": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.2, 10], ">1000": [80, 3.2, 10] },
            "Perumahan Kepadatan Sedang (R-3) k-3": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.4, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 2.8, 10] }
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1)": { "40-100": [80, 3, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) k-3": { "40-100": [80, 3.5, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) k-4": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.1, 5], "101-200": [80, 4, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-3": { "40-100": [80, 3.2, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-4": { "40-100": [80, 2.8, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] }
        },
        "KT": {
            "Perkantoran (KT) k-3": { "40-100": [80, 2.1, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 5] }
        },
        "RTNH": {
            "Ruang Terbuka Non Hijau (RTNH)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [80, 3.2, 10], "101-200": [80, 3.5, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.6, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kota (SPU-1) k-3": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1An00": [70, 3.6, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kecamatan (SPU-2)": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kecamatan (SPU-2) k-3": { "40-100": [80, 2.8, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3)": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [70, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.4, 10], "201-400": [70, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }
        },
        "HanKam": {
            "Pertahanan dan Keamanan (HK)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        # Zona lain yang ada di ZONA_OPTIONS (script.js) tapi tidak ada di gambar SWP I
        "Trans": {},
        "C": {}
    },
    # --- AKHIR DATA BARU SWP I ---

    # --- TAMBAHKAN DATA BARU SWP J MULAI DARI SINI ---
    "J": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Perlindungan Setempat (PS) k-3": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kecamatan (RTH-3)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) I-4": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman RW (RTH-5)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Pemakaman (RTH-7)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Jalur Hijau (RTH-8)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "CB": {
            "Cagar Budaya (CB) I-4": { "40-100": [70, 1.2, 10], "101-200": [70, 1.2, 10], "201-400": [70, 1.6, 10], "401-1000": [70, 1.6, 10], ">1000": [70, 2.1, 10] },
            "Cagar Budaya (CB) I-5": { "40-100": [80, 2.8, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.2, 10] }
        },
        "BJ": {
            "Badan Jalan (BJ)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] },
            "Perumahan Kepadatan Sedang (R-3) k-3": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.4, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 3.2, 10] }
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1) k-3": { "40-100": [80, 3.5, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-3": { "40-100": [80, 3.2, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] }
        },
        "KT": {
            "Perkantoran (KT)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "RTNH": {
            "Ruang Terbuka Non Hijau (RTNH) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.4, 10], "201-400": [80, 3, 10], "401-1000": [70, 3, 10], ">1000": [70, 3.2, 10] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1) k-3": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.6, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kecamatan (SPU-2) k-3": { "40-100": [80, 2.8, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [70, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }
        },
        "HanKam": {
            "Pertahanan dan Keamanan (HK)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "Trans": {
            "Transportasi (TR)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "C": {
            "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR DATA BARU SWP J ---

    # --- TAMBAHKAN DATA BARU SWP K MULAI DARI SINI ---
    "K": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kecamatan (RTH-3)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kelurahan (RTH-4)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman RW (RTH-5)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Pemakaman (RTH-7)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Jalur Hijau (RTH-8)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "CB": {
            "Cagar Budaya (CB) I-8": { "40-100": [70, 1.5, 15], "101-200": [70, 1.5, 15], "201-400": [70, 1.5, 15], "401-1000": [70, 1.5, 15], ">1000": [70, 1.5, 15] }
        },
        "BJ": {
            "Badan Jalan (BJ)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-4": { "40-100": [80, 2.1, 10], "101-200": [80, 2.1, 10], "201-400": [80, 2.1, 10], "401-1000": [80, 2.8, 10], ">1000": [80, 3.2, 10] },
            "Perumahan Kepadatan Sedang (R-3)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1) k-4": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 10], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 10], "201-400": [80, 4.2, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-4": { "40-100": [80, 2.8, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] }
        },
        "KT": {
            "Perkantoran (KT) k-4": { "40-100": [80, 2.8, 5], "101-200": [80, 3.5, 5], "201-400": [80, 3.5, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] }
        },
        "RTNH": {
            "Ruang Terbuka Non Hijau (RTNH)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "SPU Skala Kecamatan (SPU-2) k-4": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3) k-4": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [70, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }
        },
        "HanKam": {
            "Pertahanan dan Keamanan (HK)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "Trans": {
            "Transportasi (TR)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "C": {
            "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR DATA BARU SWP K ---
    # --- REVISI DATA SWP L (PERBAIKAN TYPO) ---
    "L": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kecamatan (RTH-3)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman RW (RTH-5)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7) k-3": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "CB": {
            "Cagar Budaya (CB)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "BJ": {
            "Badan Jalan (BJ)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2)": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.6, 10], "401-1000": [80, 4, 10], ">1000": [80, 4, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-3": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-6": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3, 10], ">1000": [80, 3.5, 10] },
            "Perumahan Kepadatan Sedang (R-3)": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.2, 10], ">1000": [80, 3.2, 10] },
            "Perumahan Kepadatan Sedang (R-3) k-3": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.4, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 3.2, 10] }
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1) b": { "40-100": [80, 4, 5], "101-200": [80, 4.8, 5], "201-400": [80, 5.6, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) k-3": { "40-100": [80, 3.5, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-3": { "40-100": [80, 3.2, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-6": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 5], "201-400": [80, 4, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.2, 10] }
        },
        "KT": {
            "Perkantoran (KT)": { "40-100": [80, 2.8, 5], "101-200": [80, 3.5, 5], "201-400": [80, 3.5, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perkantoran (KT) b": { "40-100": [80, 2.8, 5], "101-200": [80, 3.5, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] }
        },
        "RTNH": {
            "Ruang Terbuka Non Hijau (RTNH)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [80, 3.2, 10], "101-200": [80, 4, 10], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.8, 10] },
            "SPU Skala Kecamatan (SPU-2) b": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3)": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] }
        },
        "HanKam": {
            "Pertahanan dan Keamanan (HK)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "Trans": {
            "Transportasi (TR)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "C": {
            "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR REVISI SWP L ---

    # --- TAMBAHKAN DATA BARU SWP M MULAI DARI SINI ---
    "M": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Perlindungan Setempat (PS) k-2": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [30, 0.6, 0], "101-200": [30, 0.6, 0], "201-400": [30, 0.6, 0], "401-1000": [30, 0.6, 0], ">1000": [30, 0.6, 60] },
            "Taman Kota (RTH-2) k-2": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] },
            "Taman Kecamatan (RTH-3)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) k-2": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kecamatan (RTH-3) tod-3; b": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman RW (RTH-5)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman RW (RTH-5) tod-3; b": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Pemakaman (RTH-7) k-2": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "CB": {
            "Cagar Budaya (CB) I-2": { "40-100": [70, 2.1, 10], "101-200": [70, 2.8, 10], "201-400": [70, 2.8, 10], "401-1000": [70, 3.2, 10], ">1000": [70, 3.5, 10] }
        },
        "BJ": {
            "Badan Jalan (BJ)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2)": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-2": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 3.5, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-4": { "40-100": [80, 2.1, 10], "101-200": [80, 2.1, 10], "201-400": [80, 2.1, 10], "401-1000": [80, 2.8, 10], ">1000": [80, 3.2, 10] },
            "Perumahan Kepadatan Tinggi (R-2) k-5": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.2, 10], "401-1000": [80, 4, 10], ">1000": [80, 4, 10] },
            "Perumahan Kepadatan Sedang (R-3)": { "40-1D0": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.2, 10], ">1000": [80, 3.2, 10] },
            "Perumahan Kepadatan Sedang (R-3) k-2": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.2, 10], ">1000": [80, 3.2, 10] },
            "Perumahan Kepadatan Sedang (R-3) k-3": { "40-100": [80, 1.8, 10], "101-200": [80, 1.8, 10], "201-400": [80, 2.4, 10], "401-1000": [80, 2.4, 10], ">1000": [80, 3.2, 10] }
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1)": { "40-100": [80, 3.6, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) b": { "40-100": [90, 4, 5], "101-200": [90, 4.8, 5], "201-400": [80, 5.2, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) k-2": { "40-100": [80, 3.6, 5], "101-200": [80, 4, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) k-4": { "40-100": [80, 3.6, 5], "101-200": [80, 4, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-2": { "40-100": [80, 2.8, 10], "101-200": [80, 3.2, 15], "201-400": [80, 4, 15], "401-1000": [80, 4.8, 15], ">1000": [80, 5.6, 15] },
            "Perdagangan dan Jasa Skala WP (K-2) k-4": { "40-100": [80, 2.8, 5], "101-200": [80, 3.2, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 3.6, 10], ">1000": [80, 4.8, 10] },
            "Perdagangan dan Jasa Skala WP (K-2) k-5": { "40-100": [80, 2.8, 5], "101-200": [80, 3.6, 5], "201-400": [80, 3.6, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.8, 10] }
        },
        "KT": {
            "Perkantoran (KT)": { "40-100": [80, 2.8, 5], "101-200": [80, 3.5, 5], "201-400": [80, 3.5, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] },
            "Perkantoran (KT) k-4": { "40-100": [80, 2.8, 5], "101-200": [80, 3.5, 5], "201-400": [80, 3.5, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] }
        },
        "RTNH": {
            "Ruang Terbuka Non Hijau (RTNH) k-2": { "40-100": [80, 2.4, 10], "101-200": [80, 2.4, 10], "201-400": [80, 3, 10], "401-1000": [70, 3, 10], ">1000": [70, 3.2, 10] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [80, 3.2, 10], "101-200": [80, 4, 10], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.8, 10] },
            "SPU Skala Kota (SPU-1) k-2": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.8, 10] },
            "SPU Skala Kota (SPU-1) k-4": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4.8, 10] },
            "SPU Skala Kota (SPU-1) k-5": { "40-100": [80, 3.2, 10], "101-200": [80, 3.5, 10], "201-400": [70, 3.5, 10], "401-1000": [70, 4, 10], ">1000": [70, 4.8, 10] },
            "SPU Skala Kota (SPU-1) b": { "40-100": [80, 2.8, 10], "101-200": [80, 3.6, 10], "201-400": [80, 3.6, 10], "401-1000": [80, 4.5, 10], ">1000": [80, 4.8, 10] },
            "SPU Skala Kecamatan (SPU-2)": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 4.2, 10] },
            "SPU Skala Kecamatan (SPU-2) k-2": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3)": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 3.5, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3) k-2": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [70, 3.5, 10], ">1000": [70, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3) tod-3; b": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 4.2, 10] }
        },
        "HanKam": {
            "Pertahanan dan Keamanan (HK)": { "40-100": [80, 3.2, 5], "101-200": [80, 3.6, 5], "201-400": [80, 4, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.8, 10] }
        },
        "Trans": {
            "Transportasi (TR) tod-3; b": { "40-100": [90, 4, 5], "101-200": [90, 4.8, 5], "201-400": [80, 5.6, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] }
        },
        "C": {
            "Campuran Intensitas Tinggi (C-1) tod-3; b": { "40-100": [90, 4, 5], "101-200": [90, 4.8, 5], "201-400": [80, 5.6, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR DATA BARU SWP M ---

    # --- TAMBAHKAN DATA BARU SWP N MULAI DARI SINI ---
    "N": {
        "PS": {
            "Perlindungan Setempat (PS)": { "40-100": [25, 0.5, 60], "101-200": [25, 0.5, 60], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "RTH": {
            "Taman Kota (RTH-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Taman Kecamatan (RTH-3)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman Kelurahan (RTH-4)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Taman RW (RTH-5)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Pemakaman (RTH-7)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] },
            "Jalur Hijau (RTH-8)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "CB": {
            "Cagar Budaya (CB)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "BJ": {
            "Badan Jalan (BJ)": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] }
        },
        "R": {
            "Perumahan Kepadatan Tinggi (R-2)": { "40-100": [80, 2.4, 10], "101-200": [80, 3.2, 10], "201-400": [80, 4, 10], "401-1000": [80, 4, 10], ">1000": [80, 4, 10] },
            "Perumahan Kepadatan Sedang (R-3)": { "40-100": [80, 2.1, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.2, 10], ">1000": [80, 3.2, 10] }
        },
        "K": {
            "Perdagangan dan Jasa Skala Kota (K-1)": { "40-100": [80, 3.6, 5], "101-200": [80, 4.2, 5], "201-400": [80, 4.8, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala Kota (K-1) Kawasan penerapan TPZ bonus": { "40-100": [90, 4, 5], "101-200": [90, 4.8, 5], "201-400": [80, 5.6, 10], "401-1000": [80, 6, 10], ">1000": [80, 6.4, 10] },
            "Perdagangan dan Jasa Skala WP (K-2)": { "40-100": [80, 2.8, 5], "101-200": [80, 4, 5], "201-400": [80, 4.2, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] }
        },
        "KT": {
            "Perkantoran (KT)": { "40-100": [80, 2.8, 5], "101-200": [80, 3.5, 5], "201-400": [80, 3.5, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 5.6, 10] }
        },
        "RTNH": {
            "Ruang Terbuka Non Hijau (RTNH)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "SPU": {
            "SPU Skala Kota (SPU-1)": { "40-100": [80, 3.2, 10], "101-200": [80, 4, 10], "201-400": [80, 4, 10], "401-1000": [80, 4.2, 10], ">1000": [80, 4.8, 10] },
            "SPU Skala Kota (SPU-1) Kawasan penerapan TPZ bonus": { "40-100": [80, 3.2, 10], "101-200": [80, 4, 10], "201-400": [80, 4.8, 10], "401-1000": [80, 4.8, 10], ">1000": [80, 4.8, 10] },
            "SPU Skala Kecamatan (SPU-2)": { "40-100": [80, 3.2, 10], "101-200": [80, 3.2, 10], "201-400": [80, 3.5, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 4.2, 10] },
            "SPU Skala Kelurahan (SPU-3)": { "40-100": [80, 2.4, 10], "101-200": [80, 2.8, 10], "201-400": [80, 2.8, 10], "401-1000": [80, 3.5, 10], ">1000": [80, 4.2, 10] }
        },
        "HanKam": {
            "Pertahanan dan Keamanan (HK)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "Trans": {
            "Transportasi (TR)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        },
        "C": {
            "Campuran Intensitas Tinggi (C-1)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] },
            "Campuran Intensitas Menengah/Sedang (C-2)": { "40-100": [0, 0, 0], "101-200": [0, 0, 0], "201-400": [0, 0, 0], "401-1000": [0, 0, 0], ">1000": [0, 0, 0] }
        }
    },
    # --- AKHIR DATA BARU SWP N ---


    # --- (Tambahkan data SWP C, D, E, ... N Anda di sini) ---
    "DEFAULT_PLACEHOLDER": {
        "PS": { "PS-1": { "40-100": [40, 0.8, 40], "101-200": [40, 0.8, 40], "201-400": [35, 0.7, 40], "401-1000": [30, 0.6, 40], ">1000": [30, 0.6, 40] } },
        "RTH": { "RTH-Default": { "40-100": [30, 0.6, 50], "101-200": [30, 0.6, 50], "201-400": [30, 0.6, 60], "401-1000": [30, 0.6, 60], ">1000": [30, 0.6, 60] } },
        "BJ": { "BJ-Default": { "40-100": [25, 0.5, 50], "101-200": [25, 0.5, 50], "201-400": [20, 0.6, 60], "401-1000": [20, 0.6, 60], ">1000": [20, 0.6, 60] } },
        "CB": { "CB-1": { "40-100": [50, 1.0, 30], "101-200": [50, 1.0, 30], "201-400": [50, 1.0, 30], "401-1000": [50, 1.0, 30], ">1000": [50, 1.0, 30] } },
        "R": { "R-1": { "40-100": [60, 1.2, 20], "101-200": [60, 1.2, 20], "201-400": [55, 1.1, 25], "401-1000": [50, 1.0, 30], ">1000": [40, 0.8, 40] } },
        "K": { "K-1": { "40-100": [80, 3.5, 10], "101-200": [80, 4.2, 10], "201-400": [80, 4.8, 10], "401-1000": [80, 5.6, 10], ">1000": [80, 5.0, 10] } },
        "SPU": { "SPU-1": { "40-100": [50, 1.5, 30], "101-200": [50, 1.5, 30], "201-400": [45, 1.5, 30], "401-1000": [40, 1.5, 30], ">1000": [40, 1.5, 30] } },
        "HanKam": { "HanKam-1": { "40-100": [40, 0.8, 40], "101-200": [40, 0.8, 40], "201-400": [35, 0.7, 40], "401-1000": [30, 0.6, 40], ">1000": [30, 0.6, 40] } },
        "Trans": { "Trans-1": { "40-100": [50, 1.0, 30], "101-200": [50, 1.0, 30], "201-400": [45, 1.0, 30], "401-1000": [40, 1.0, 30], ">1000": [40, 1.0, 30] } }
    }
}


# =======================================================================
# FUNGSI HELPER
# =======================================================================

def get_data(data_dict, key, default="-"):
    """Mengambil data dari dictionary dengan nilai default aman."""
    val = data_dict.get(key)
    return str(val) if val else default

def format_tanggal_indo_lengkap():
    """Output: Kamis, tanggal 9 bulan Oktober tahun 2025"""
    hari_list = ["Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu", "Minggu"]
    bulan_list = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", 
                  "Juli", "Agustus", "September", "Oktober", "November", "Desember"]
    
    now = datetime.datetime.now()
    hari = hari_list[now.weekday()]
    tanggal = now.day
    bulan = bulan_list[now.month - 1]
    tahun = now.year
    
    return f"{hari}, tanggal {tanggal} bulan {bulan} tahun {tahun}"

def format_tanggal_short():
    """Output: 9 Oktober 2025"""
    bulan_list = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", 
                  "Juli", "Agustus", "September", "Oktober", "November", "Desember"]
    now = datetime.datetime.now()
    return f"{now.day} {bulan_list[now.month - 1]} {now.year}"

# =======================================================================
# LOGIKA UTAMA (PERHITUNGAN & MESSAGE)
# =======================================================================

def proses_cek_kepatuhan(data):
    try:
        swp_pilihan = data.get('swpPilihan')
        zona_pilihan = data.get('zonaPilihan')
        sub_zona_pilihan = data.get('subZonaPilihan')
        luas_persil_pilihan = data.get('luasPersilPilihan')

        # 1. Ambil Rules
        swp_rules = ATURAN_LENGKAP_SWP.get(swp_pilihan, ATURAN_LENGKAP_SWP.get("DEFAULT_PLACEHOLDER", {}))
        zona_rules = swp_rules.get(zona_pilihan)

        if not zona_rules:
            zona_rules = ATURAN_LENGKAP_SWP.get("DEFAULT_PLACEHOLDER", {}).get(zona_pilihan, {})

        kunci_aturan_final = ""
        is_sub_zona_required = data.get('isSubZonaRequired')
        
        if is_sub_zona_required and sub_zona_pilihan in zona_rules:
            kunci_aturan_final = sub_zona_pilihan
        elif zona_rules:
            kunci_aturan_final = list(zona_rules.keys())[0]
        else:
            return {"error": f"Zona {zona_pilihan} tidak ditemukan konfigurasinya."}, 400

        aturan_spesifik_dict = zona_rules.get(kunci_aturan_final, {})
        ATURAN_SPESIFIK = aturan_spesifik_dict.get(luas_persil_pilihan)

        if not ATURAN_SPESIFIK:
            return {"error": f"Aturan luas lahan '{luas_persil_pilihan}' tidak ditemukan pada {kunci_aturan_final}."}, 400

        KDB_MAKS, KLB_MAKS, KDH_MIN = ATURAN_SPESIFIK

        # 2. Ambil Input User & Hitung
        luas_persil_input = float(data.get('luasPersilInput', 0))
        luas_bangunan = float(data.get('luasBangunanDiusulkan', 0))
        luas_lantai = float(data.get('luasLantaiDiusulkan', 0))
        ketinggian = float(data.get('ketinggian', 0))
        
        kdb_diusulkan = float(data.get('kdbDiusulkan', 0)) 
        kdh_diusulkan = float(data.get('kdhDiusulkan', 0))
        
        klb_aktual = luas_lantai / luas_persil_input if luas_persil_input > 0 else 0

        # 3. Cek Kepatuhan
        detail_pemeriksaan = []

        # [0] KDB
        status_kdb = 'pass' if kdb_diusulkan <= KDB_MAKS else 'fail'
        msg_kdb = f"KDB Hasil Perhitungan ({kdb_diusulkan:.2f}%) {'memenuhi' if status_kdb == 'pass' else 'melebihi'} batas maksimum ({KDB_MAKS}%)."
        detail_pemeriksaan.append({
            "status": status_kdb, 
            "message": msg_kdb,
            "label": "KDB", 
            "val": kdb_diusulkan, 
            "limit": KDB_MAKS
        })

        # [1] LBD
        lbd_maks = luas_persil_input * (KDB_MAKS / 100)
        status_lbd = 'pass' if luas_bangunan <= lbd_maks else 'fail'
        msg_lbd = f"Luas Dasar Bangunan ({luas_bangunan} m) {'aman' if status_lbd == 'pass' else 'terlalu besar'} (Maks: {lbd_maks:.1f} m)."
        detail_pemeriksaan.append({
            "status": status_lbd, 
            "message": msg_lbd,
            "label": "LBD", 
            "val": luas_bangunan, 
            "limit": lbd_maks
        })

        # [2] KLB
        status_klb = 'pass' if klb_aktual <= KLB_MAKS else 'fail'
        msg_klb = f"Koefisien Lantai Bangunan ({klb_aktual:.2f}) {'memenuhi' if status_klb == 'pass' else 'melebihi'} batas maksimum ({KLB_MAKS})."
        detail_pemeriksaan.append({
            "status": status_klb, 
            "message": msg_klb,
            "label": "KLB", 
            "val": klb_aktual, 
            "limit": KLB_MAKS
        })

        # [3] KDH
        status_kdh = 'pass' if kdh_diusulkan >= KDH_MIN else 'fail'
        msg_kdh = f"KDH Hasil Pengukuran ({kdh_diusulkan:.2f}%) {'cukup' if status_kdh == 'pass' else 'kurang'} dari batas minimum ({KDH_MIN}%)."
        detail_pemeriksaan.append({
            "status": status_kdh, 
            "message": msg_kdh,
            "label": "KDH", 
            "val": kdh_diusulkan, 
            "limit": KDH_MIN
        })

        # [4] Ketinggian
        status_tb = 'pass' if ketinggian <= ATURAN_TINGGI_MAKS else 'fail'
        msg_tb = f"Ketinggian ({ketinggian} m) {'aman' if status_tb == 'pass' else 'melebihi'} batas ({ATURAN_TINGGI_MAKS} m)."
        detail_pemeriksaan.append({
            "status": status_tb, 
            "message": msg_tb,
            "label": "Tinggi", 
            "val": ketinggian, 
            "limit": ATURAN_TINGGI_MAKS
        })

        is_patuh = not any(x['status'] == 'fail' for x in detail_pemeriksaan)

        return {
            "isPatuh": is_patuh,
            "detailPemeriksaan": detail_pemeriksaan,
            "klbAktual": klb_aktual,
            "kdbMaks": KDB_MAKS,
            "klbMaks": KLB_MAKS,
            "kdhMin": KDH_MIN,
            "aturanTinggi": ATURAN_TINGGI_MAKS
        }

    except Exception as e:
        return {"error": str(e)}, 500

# =======================================================================
# GENERATOR DOKUMEN 1: PMP (MODIFIKASI DI SINI SESUAI REQUEST)
# =======================================================================
def create_pmp_doc(data, hasil):
    doc = Document()
    
    sec = doc.sections[0]
    sec.left_margin = Mm(20); sec.right_margin = Mm(20)
    sec.top_margin = Mm(20); sec.bottom_margin = Mm(20)

    # Header
    p = doc.add_paragraph()
    p.alignment = WD_ALIGN_PARAGRAPH.CENTER
    run = p.add_run("REKOMENDASI HASIL PENILAIAN\nPERNYATAAN MANDIRI PELAKU USAHA MIKRO DAN KECIL")
    run.bold = True
    run.font.size = Pt(12)

    # Intro
    p_intro = doc.add_paragraph()
    p_intro.add_run(f'\n"Pada hari ini {format_tanggal_indo_lengkap()} ,telah dilaksanakan penilaian Pernyataan Mandiri Pelaku Usaha Mikro dan Kecil (UMK) terhadap: "')

    # Biodata
    table_bio = doc.add_table(rows=5, cols=3)
    table_bio.style = 'Table Grid'
    table_bio.autofit = False
    table_bio.columns[0].width = Mm(45); table_bio.columns[1].width = Mm(5); table_bio.columns[2].width = Mm(110)

    def row_bio(idx, label, val):
        table_bio.cell(idx, 0).text = label
        table_bio.cell(idx, 1).text = ":"
        table_bio.cell(idx, 2).text = str(val)

    row_bio(0, "Nama Pelaku Usaha", get_data(data, 'namaPemohon'))
    row_bio(1, "Nomor Identitas", get_data(data, 'nikPemohon'))
    row_bio(2, "Alamat", get_data(data, 'alamatPemohon'))
    row_bio(3, "Nomor Telepon", get_data(data, 'nomorTelepon'))
    row_bio(4, "Email", get_data(data, 'emailPemohon'))

    doc.add_paragraph('\n"Berdasarkan hasil survei lapangan dan analisis, diperoleh hasil penilaian Pernyataan Mandiri Pelaku Usaha Mikro dan Kecil UMK sebagai berikut: "')
    doc.add_paragraph("Hasil Penilaian Pernyataan Mandiri Pelaku UMK").alignment = WD_ALIGN_PARAGRAPH.CENTER

    # Tabel Hasil (6 Kolom)
    t_hasil = doc.add_table(rows=1, cols=6)
    t_hasil.style = 'Table Grid'
    
    hdr = t_hasil.rows[0].cells
    hdr[0].text = "No"; hdr[1].text = "Muatan yang Dinilai"
    hdr[2].text = "Hasil Penilaian\n(Sesuai/Tidak Sesuai)"
    hdr[3].text = "Keterangan"; hdr[4].text = "Dasar Aturan"; hdr[5].text = "Rekomendasi"

    for cell in hdr:
        cell.paragraphs[0].runs[0].bold = True
        cell.paragraphs[0].alignment = WD_ALIGN_PARAGRAPH.CENTER
        cell.vertical_alignment = WD_ALIGN_VERTICAL.CENTER

    def add_res_row(no, muatan, status, ket_angka, aturan, rek):
        r = t_hasil.add_row().cells
        r[0].text = str(no); r[1].text = muatan; r[2].text = status
        r[3].text = ket_angka; r[4].text = aturan; r[5].text = rek

    # Ambil Rentang Luas Persil Pilihan (e.g., "401-1000")
    luas_persil_pilihan = get_data(data, 'luasPersilPilihan')

    # Pemeriksaan
    r_judul1 = t_hasil.add_row().cells
    r_judul1[0].merge(r_judul1[5])
    r_judul1[0].text = "Pemeriksaan"; r_judul1[0].paragraphs[0].runs[0].bold = True

    add_res_row("1", "Lokasi Kegiatan", "Sesuai", get_data(data, 'alamatPemohon'), "-", "Tidak ada rekomendasi")
    add_res_row("2", "Jenis Kegiatan", "Sesuai", get_data(data, 'jenisKegiatan'), "-", "Tidak ada rekomendasi")

    # Pengukuran
    r_judul2 = t_hasil.add_row().cells
    r_judul2[0].merge(r_judul2[5])
    r_judul2[0].text = "Pengukuran (opsional)"; r_judul2[0].paragraphs[0].runs[0].bold = True

    # KDB (TEKS LENGKAP PMP)
    check_kdb = hasil['detailPemeriksaan'][0]
    stat_kdb = "Sesuai" if check_kdb['status'] == 'pass' else "Tidak Sesuai"
    rek_kdb = "Tidak ada rekomendasi" if stat_kdb == "Sesuai" else "Perlu penyesuaian"
    
    # Format Text KDB PMP
    aturan_kdb_text = f"Berdasarkan Peraturan Walikota Yogyakarta Nomor 118 Tahun 2021 Tentang RDTR Luas Tanah/Persil {luas_persil_pilihan} m2 KDB <{check_kdb['limit']}%"

    add_res_row("1", "Koefisien Dasar Bangunan", stat_kdb, 
                f"({check_kdb['val']:.2f}%)", 
                aturan_kdb_text, 
                rek_kdb)

    # KLB (TEKS LENGKAP PMP)
    check_klb = hasil['detailPemeriksaan'][2]
    stat_klb = "Sesuai" if check_klb['status'] == 'pass' else "Tidak Sesuai"
    rek_klb = "Tidak ada rekomendasi" if stat_klb == "Sesuai" else "Perlu penyesuaian"
    
    # Format Text KLB PMP
    aturan_klb_text = f"Berdasarkan Peraturan Walikota Yogyakarta Nomor 118 Tahun 2021 Tentang RDTR Luas Tanah/Persil {luas_persil_pilihan} m2 KLB <{check_klb['limit']}"

    add_res_row("2", "Koefisien Lantai Bangunan", stat_klb, 
                f"({check_klb['val']:.2f})", 
                aturan_klb_text, 
                rek_klb)

    # GSB
    gsb_val = get_data(data, 'gsbDiusulkan', '0')
    stat_gsb = "Tidak Sesuai" if gsb_val == '0' else "Sesuai"
    rek_gsb = "Perlu penyesuaian" if stat_gsb == "Tidak Sesuai" else "Tidak ada rekomendasi"
    add_res_row("3", "Garis Sempadan Bangunan", stat_gsb, 
                f"({gsb_val} m)", "Perwal No 118 Th 2021", rek_gsb)

    # Jarak Bebas
    add_res_row("4", "Jarak Bebas Bangunan", "Sesuai", "U:0m S:0m", "Perwal No 118 Th 2021", "Tidak ada rekomendasi")

    # KDH (TEKS LENGKAP PMP)
    check_kdh = hasil['detailPemeriksaan'][3]
    stat_kdh = "Sesuai" if check_kdh['status'] == 'pass' else "Tidak Sesuai"
    rek_kdh = "Tidak ada rekomendasi" if stat_kdh == "Sesuai" else "Perlu penambahan RTH"
    
    # Format Text KDH PMP
    aturan_kdh_text = f"Berdasarkan Peraturan Walikota Kota Yogyakarta No 118 Tahun 2021 Tentang Koefisien Dasar Hijau >{check_kdh['limit']}%"

    add_res_row("5", "Koefisien Dasar Hijau", stat_kdh, 
                f"({check_kdh['val']:.2f}%)", 
                aturan_kdh_text, 
                rek_kdh)

    # Basement
    add_res_row("6", "Koefisien Tapak Basement", "-", "-", "-", "Tidak ada rekomendasi")

    # Ketinggian
    check_tb = hasil['detailPemeriksaan'][4]
    stat_tb = "Sesuai" if check_tb['status'] == 'pass' else "Tidak Sesuai"
    rek_tb = "Tidak ada rekomendasi" if stat_tb == "Sesuai" else "Perlu penyesuaian"
    add_res_row("7", "Ketinggian Bangunan", stat_tb, 
                f"({check_tb['val']} m)", 
                f"Perwal No 118 Th 2021 (Maks {check_tb['limit']} m)", rek_tb)

    # Kesimpulan
    doc.add_paragraph('\n"Berdasarkan hasil penilaian tersebut, diperoleh kesimpulan sebagai berikut:"')
    p_sim = doc.add_paragraph("Kegiatan Pemanfaatan Ruang berdasarkan pernyataan mandiri yang dibuat oleh pelaku UMK dinyatakan ")
    
    if hasil['isPatuh']:
        p_sim.add_run("SESUAI").bold = True; p_sim.add_run(".")
    else:
        p_sim.add_run("TIDAK SESUAI").bold = True
        p_sim.add_run(" dan perlu menyesuaikan kondisi di lapangan.")

    doc.add_paragraph('"Demikian untuk dapat digunakan sebagai acuan dalam penetapan hasil penilaian PMP UMK, atas perhatiannya diucapkan terimakasih."')
    doc.add_paragraph("CP : 085601174240 (Bidang Dalwas DPTR Kota Yogyakarta)")

    # Tanda Tangan
    doc.add_paragraph()
    t_ttd = doc.add_table(rows=1, cols=2)
    t_ttd.autofit = False
    t_ttd.columns[0].width = Mm(80); t_ttd.columns[1].width = Mm(90)
    
    c = t_ttd.cell(0, 1)
    c.add_paragraph(f"Yogyakarta, {format_tanggal_short()}").alignment = WD_ALIGN_PARAGRAPH.CENTER
    c.add_paragraph("Kepala Bidang\nPengendalian dan Pengawasan\nDinas Pertanahan dan Tata Ruang\n( Kundha Niti Mandala Sarta Tata Sasana )").alignment = WD_ALIGN_PARAGRAPH.CENTER
    c.add_paragraph("\n\n")
    p_nama = c.add_paragraph("(Arif Amrullah, M.T., M.Sc.)"); p_nama.runs[0].bold = True; p_nama.alignment = WD_ALIGN_PARAGRAPH.CENTER
    c.add_paragraph("NIP. 197510132005011007").alignment = WD_ALIGN_PARAGRAPH.CENTER

    return doc

# =======================================================================
# GENERATOR DOKUMEN 2: IKKPR (MODIFIKASI KLB & KDH DISINI)
# =======================================================================
def create_ikkpr_doc(data, hasil):
    doc = Document()
    
    sec = doc.sections[0]
    sec.left_margin = Mm(20); sec.right_margin = Mm(20)
    
    # Header
    p = doc.add_paragraph()
    p.alignment = WD_ALIGN_PARAGRAPH.CENTER
    run = p.add_run("REKOMENDASI HASIL KEPATUHAN PELAKSANAAN KETENTUAN\nKESESUAIAN KEGIATAN PEMANFAATAN RUANG\nPERIODE PASCA PEMBANGUNAN")
    run.bold = True
    
    # Intro
    p_intro = doc.add_paragraph()
    p_intro.add_run(f'\n"Pada hari {format_tanggal_indo_lengkap()}, telah dilaksanakan Pemeriksaan dan Pengukuran Kepatuhan Pelaksanaan Ketentuan Kesesuaian Kegiatan Pemanfaatan Ruang (KKPR) pada periode pasca pembangunan terhadap:"')
    doc.add_paragraph("Penilaian kepatuhan pelaksanaan ketentuan Kesesuaian Kegiatan Pemanfaatan Ruang dilakukan oleh:")

    # Data Bio
    t_bio = doc.add_table(rows=5, cols=3)
    t_bio.style = 'Table Grid'
    t_bio.autofit = False
    t_bio.columns[0].width = Mm(50); t_bio.columns[1].width = Mm(5); t_bio.columns[2].width = Mm(110)

    def row_bio(idx, label, val):
        t_bio.cell(idx, 0).text = label
        t_bio.cell(idx, 1).text = ":"
        t_bio.cell(idx, 2).text = str(val)

    row_bio(0, "Jenis KKPR", "KKKPR")
    row_bio(1, "Nomor KKPR", "15092210113471013")
    row_bio(2, "Nama Pemegang KKPR", get_data(data, 'namaPemohon'))
    row_bio(3, "Alamat", get_data(data, 'alamatPemohon'))
    row_bio(4, "Email", get_data(data, 'emailPemohon'))

    doc.add_paragraph('\n"Berdasarkan hasil survei lapangan dan analisis, diperoleh hasil penilaian kepatuhan pelaksanaan ketentuan KKPR sebagai berikut: "')
    doc.add_paragraph("Hasil Penilaian Kepatuhan Pelaksanaan Ketentuan KKPR").alignment = WD_ALIGN_PARAGRAPH.CENTER

    # Tabel Hasil (6 Kolom)
    t_hasil = doc.add_table(rows=1, cols=6)
    t_hasil.style = 'Table Grid'
    
    hdr = t_hasil.rows[0].cells
    hdr[0].text = "No"; hdr[1].text = "Muatan KKPR yang Dinilai"
    hdr[2].text = "Hasil pemeriksaan dokumen\n(Termuat/Tidak)"
    hdr[3].text = "Hasil Penilaian Kepatuhan\n(Patuh/Tidak Patuh)"
    hdr[4].text = "Keterangan"; hdr[5].text = "Rekomendasi"

    for cell in hdr:
        cell.paragraphs[0].runs[0].bold = True
        cell.paragraphs[0].alignment = WD_ALIGN_PARAGRAPH.CENTER
        cell.vertical_alignment = WD_ALIGN_VERTICAL.CENTER

    def add_kkpr_row(no, muatan, doc_status, nilai_status, ket, rek):
        r = t_hasil.add_row().cells
        r[0].text = str(no); r[1].text = muatan; r[2].text = doc_status
        r[3].text = nilai_status; r[4].text = ket; r[5].text = rek

    luas_persil_user = get_data(data, 'luasPersilInput')

    # 1. Lokasi
    add_kkpr_row("1", "Lokasi Kegiatan", "Termuat", f"{get_data(data, 'alamatPemohon')}\n(Patuh)", "Sesuai dokumen", "Tidak ada rekomendasi")
    
    # 2. Jenis Kegiatan
    add_kkpr_row("2", "Jenis Kegiatan", "Termuat", f"{get_data(data, 'jenisKegiatan')}\n(Patuh)", "Sesuai KBLI", "Tidak ada rekomendasi")
    
    # 3. Jenis Peruntukan
    add_kkpr_row("3", "Jenis Peruntukan Pemanfaatan Ruang", "Termuat", f"{get_data(data, 'zonaPilihan')}\n(Patuh)", "Sesuai zonasi", "Tidak ada rekomendasi")

    # 4. KDB (FULL TEXT)
    check_kdb = hasil['detailPemeriksaan'][0]
    stat_kdb = "(Patuh)" if check_kdb['status'] == 'pass' else "(Tidak Patuh)"
    ket_kdb = f"Berdasarkan Perwal Kota Yogyakarta No 118 Tahun 2021 Tentang RDTR Luas Tanah/Persil {luas_persil_user} m2 KDB <{check_kdb['limit']}%"
    
    add_kkpr_row("4", "Koefisien Dasar Bangunan", "Termuat", 
                 f"{check_kdb['val']:.2f}%\n{stat_kdb}", 
                 ket_kdb, 
                 "Tidak ada rekomendasi" if stat_kdb == "(Patuh)" else "Sesuaikan")

    # 5. KLB (MODIFIKASI FULL TEXT SESUAI REQUEST)
    check_klb = hasil['detailPemeriksaan'][2]
    stat_klb = "(Patuh)" if check_klb['status'] == 'pass' else "(Tidak Patuh)"
    
    # Text Lengkap KLB
    ket_klb = f"Berdasarkan Perwal Kota Yogyakarta No 118 Tahun 2021 Tentang RDTR Luas Tanah/Persil {luas_persil_user} m2 KLB <{check_klb['limit']}"

    add_kkpr_row("5", "Koefisien Lantai Bangunan", "Termuat", 
                 f"{check_klb['val']:.2f}\n{stat_klb}", 
                 ket_klb, 
                 "Tidak ada rekomendasi" if stat_klb == "(Patuh)" else "Sesuaikan")

    # 6. Ketinggian
    check_tb = hasil['detailPemeriksaan'][4]
    stat_tb = "(Patuh)" if check_tb['status'] == 'pass' else "(Tidak Patuh)"
    add_kkpr_row("6", "Ketentuan Tata Bangunan", "Tidak Termuat", 
                 f"Tinggi {check_tb['val']} m\n{stat_tb}", 
                 f"Maks {check_tb['limit']} m", 
                 "Tidak ada rekomendasi" if stat_tb == "(Patuh)" else "Sesuaikan")
    
    # 7. Indikasi Program
    add_kkpr_row("7", "Indikasi Program Pemanfaatan Ruang", "Tidak Termuat", "-", 
                 "Berdasarkan Perwal Kota Yogyakarta No 118 Tahun 2021 Tentang RDTR pada lampirkan V", "Tidak ada rekomendasi")

    # 8. Persyaratan Pelaksanaan
    add_kkpr_row("8", "Persyaratan Pelaksanaan Kegiatan Pemanfaatan Ruang", "Tidak Termuat", "-", 
                 "Berdasarkan Perwal Kota Yogyakarta No 118 Tahun 2021 Tentang RDTR", "Tidak ada rekomendasi")
    
    # 9. Informasi Tambahan
    r_grp = t_hasil.add_row().cells
    r_grp[0].merge(r_grp[5])
    r_grp[0].text = "9. Informasi Tambahan"; r_grp[0].paragraphs[0].runs[0].bold = True

    # GSB
    gsb = get_data(data, 'gsbDiusulkan', '0')
    add_kkpr_row("", "a. Garis Sempadan Bangunan", "Termuat", f"{gsb} m\n(Patuh)", "Sesuai Aturan", "Tidak ada rekomendasi")
    
    # KDH (MODIFIKASI FULL TEXT SESUAI REQUEST)
    check_kdh = hasil['detailPemeriksaan'][3]
    stat_kdh = "(Patuh)" if check_kdh['status'] == 'pass' else "(Tidak Patuh)"
    
    # Text Lengkap KDH
    ket_kdh = f"Berdasarkan Perwal Kota Yogyakarta No 118 Tahun 2021 Tentang Koefisien Dasar Hijau >{check_kdh['limit']}%"

    add_kkpr_row("", "c. Koefisien Dasar Hijau", "Termuat", 
                 f"{check_kdh['val']:.2f}%\n{stat_kdh}", 
                 ket_kdh, 
                 "Tidak ada rekomendasi" if stat_kdh == "(Patuh)" else "Tambah RTH")

    # Kesimpulan
    doc.add_paragraph('\n"Berdasarkan hasil penilaian tersebut, diperoleh kesimpulan sebagai berikut:"')
    p_sim = doc.add_paragraph("Kegiatan Pemanfaatan Ruang berdasarkan Konfirmasi KKPR Nomor 15092210113471013 ")
    if hasil['isPatuh']:
        p_sim.add_run("perlu mempertahankan kondisi di lapangan.").bold = True
    else:
        p_sim.add_run("TIDAK PATUH dan perlu menyesuaikan kondisi di lapangan.").bold = True

    # Tanda Tangan
    doc.add_paragraph()
    t_ttd = doc.add_table(rows=1, cols=2)
    t_ttd.autofit = False
    t_ttd.columns[0].width = Mm(80); t_ttd.columns[1].width = Mm(90)
    
    c = t_ttd.cell(0, 1)
    c.add_paragraph(f"Yogyakarta, {format_tanggal_short()}").alignment = WD_ALIGN_PARAGRAPH.CENTER
    c.add_paragraph("Plt. Kepala Bidang\nPengendalian dan Pengawasan\nDinas Pertanahan dan Tata Ruang\n( Kundha Niti Mandala Sarta Tata Sasana )").alignment = WD_ALIGN_PARAGRAPH.CENTER
    c.add_paragraph("\n\n")
    p_nama = c.add_paragraph("(FX. Wahyu Setyowati, M.T)"); p_nama.runs[0].bold = True; p_nama.alignment = WD_ALIGN_PARAGRAPH.CENTER
    c.add_paragraph("NIP. 197109041997032006").alignment = WD_ALIGN_PARAGRAPH.CENTER

    return doc
# =======================================================================
# GENERATOR DOKUMEN 3: BERITA ACARA (BA) - FIX ERROR RUNS
# =======================================================================
def create_ba_doc(data, hasil):
    doc = Document()
    sec = doc.sections[0]
    sec.left_margin = Mm(20); sec.right_margin = Mm(20)
    sec.top_margin = Mm(20); sec.bottom_margin = Mm(20)

    # Header
    p = doc.add_paragraph()
    p.alignment = WD_ALIGN_PARAGRAPH.CENTER
    run = p.add_run("HASIL PEMERIKSAAN DAN PENGUKURAN\nPERNYATAAN MANDIRI PELAKU USAHA MIKRO DAN KECIL")
    run.bold = True; run.font.size = Pt(12)
    doc.add_paragraph()

    # Bio
    t_bio = doc.add_table(rows=5, cols=3)
    t_bio.style = 'Table Grid'
    t_bio.autofit = False
    t_bio.columns[0].width = Mm(50); t_bio.columns[1].width = Mm(5); t_bio.columns[2].width = Mm(110)

    def row_isi(table, idx, label, val):
        table.cell(idx, 0).text = label; table.cell(idx, 1).text = ":"; table.cell(idx, 2).text = str(val)

    row_isi(t_bio, 0, "Nama Pelaku Usaha", get_data(data, 'namaPemohon'))
    row_isi(t_bio, 1, "Nomor Identitas", get_data(data, 'nikPemohon'))
    row_isi(t_bio, 2, "Alamat", get_data(data, 'alamatPemohon'))
    row_isi(t_bio, 3, "Nomor Telepon", get_data(data, 'nomorTelepon'))
    row_isi(t_bio, 4, "Email", get_data(data, 'emailPemohon'))

    # Pemeriksaan
    p_periksa = doc.add_paragraph("\nPemeriksaan")
    p_periksa.runs[0].bold = True
    doc.add_paragraph("Lokasi Kegiatan Usaha").paragraph_format.left_indent = Mm(5)

    t_loc = doc.add_table(rows=7, cols=3)
    t_loc.style = 'Table Grid'
    t_loc.autofit = False
    t_loc.columns[0].width = Mm(50); t_loc.columns[1].width = Mm(5); t_loc.columns[2].width = Mm(110)

    alamat_lok = get_data(data, 'alamatLokasi', get_data(data, 'alamatPemohon')) 
    row_isi(t_loc, 0, "Alamat", alamat_lok)
    row_isi(t_loc, 1, "Desa/Kelurahan", get_data(data, 'kelurahanLoc', '-'))
    row_isi(t_loc, 2, "Kecamatan", get_data(data, 'kecamatanLoc', '-'))
    row_isi(t_loc, 3, "Kabupaten/Kota", "Kota Yogyakarta")
    row_isi(t_loc, 4, "Provinsi", "Daerah Istimewa Yogyakarta")
    coord = f"Lintang: {get_data(data, 'lintang', '-')} , Bujur: {get_data(data, 'bujur', '-')}"
    row_isi(t_loc, 5, "Koordinat Lokasi", coord)
    row_isi(t_loc, 6, "Jenis Kegiatan Usaha", get_data(data, 'jenisKegiatan'))

    # Pengukuran - FIXED ERROR CELL RUNS
    p_ukur = doc.add_paragraph("\nPengukuran")
    p_ukur.runs[0].bold = True

    def add_ukur_row(table, label, val, unit="m"):
        row = table.add_row().cells
        row[0].text = label; row[1].text = ":"; row[2].text = f"{val} {unit}"

    t_tek = doc.add_table(rows=0, cols=3)
    t_tek.columns[0].width = Mm(65); t_tek.columns[1].width = Mm(5); t_tek.columns[2].width = Mm(95)

    # KDB
    row_h = t_tek.add_row().cells
    row_h[0].text = "Koefisien Dasar Bangunan"
    row_h[0].paragraphs[0].runs[0].bold = True # FIXED HERE
    add_ukur_row(t_tek, "Panjang Bangunan lantai dasar", get_data(data, 'panjangBangunan', '-'))
    add_ukur_row(t_tek, "Lebar Bangunan lantai dasar", get_data(data, 'lebarBangunan', '-'))
    add_ukur_row(t_tek, "Luas Lantai Dasar Bangunan", get_data(data, 'luasBangunanDiusulkan', '0'), "m2")
    add_ukur_row(t_tek, "Luas Lahan", get_data(data, 'luasPersilInput', '0'), "m2")

    # KLB
    row_h = t_tek.add_row().cells
    row_h[0].text = "Koefisien Lantai Bangunan"
    row_h[0].paragraphs[0].runs[0].bold = True # FIXED HERE
    add_ukur_row(t_tek, "Panjang lantai bangunan", get_data(data, 'panjangBangunan', '-'))
    add_ukur_row(t_tek, "Lebar lantai bangunan", get_data(data, 'lebarBangunan', '-'))
    add_ukur_row(t_tek, "Luas seluruh lantai bangunan", get_data(data, 'luasLantaiDiusulkan', '0'), "m2")
    add_ukur_row(t_tek, "Jumlah lantai bangunan", get_data(data, 'jumlahLantai', '1'), "Lantai")

    # GSB
    row_h = t_tek.add_row().cells
    row_h[0].text = "Garis Sempadan Bangunan"
    row_h[0].paragraphs[0].runs[0].bold = True # FIXED HERE
    add_ukur_row(t_tek, "Jarak bangunan terdepan dengan pagar", get_data(data, 'gsbDiusulkan', '0'))

    # Jarak Bebas
    row_h = t_tek.add_row().cells
    row_h[0].text = "Jarak Bebas Bangunan"
    row_h[0].paragraphs[0].runs[0].bold = True # FIXED HERE
    add_ukur_row(t_tek, "Jarak bangunan terbelakang (Timur)", "0") 
    r_samping = t_tek.add_row().cells
    r_samping[0].text = "Jarak pagar samping"
    r_samping[1].text = ":"
    r_samping[2].text = "Utara : 0 m\nSelatan : 0 m\nBarat : 0 m"

    # KDH
    row_h = t_tek.add_row().cells
    row_h[0].text = "KDH"
    row_h[0].paragraphs[0].runs[0].bold = True # FIXED HERE
    add_ukur_row(t_tek, "Panjang lahan vegetasi", "-")
    add_ukur_row(t_tek, "Lebar lahan vegetasi", "-")
    luas_lahan = float(get_data(data, 'luasPersilInput', 0))
    persen_kdh = float(get_data(data, 'kdhDiusulkan', 0))
    luas_kdh_m2 = (persen_kdh / 100) * luas_lahan
    add_ukur_row(t_tek, "Luas lahan vegetasi", f"{luas_kdh_m2:.2f}", "m2")

    # Basement
    row_h = t_tek.add_row().cells
    row_h[0].text = "Koefisien Tapak Basement"
    row_h[0].paragraphs[0].runs[0].bold = True # FIXED HERE
    add_ukur_row(t_tek, "Lokasi Basement", "-")
    add_ukur_row(t_tek, "Luas Basement", "-", "m2")

    # Tinggi
    row_h = t_tek.add_row().cells; row_h[0].text = ""; 
    add_ukur_row(t_tek, "Ketinggian Bangunan", get_data(data, 'ketinggian', '0'))

    # Tanda Tangan
    doc.add_paragraph("\nDemikian Berita Acara ini dibuat dalam rangkap secukupnya untuk dipergunakan sebagaimana mestinya.")
    t_ttd = doc.add_table(rows=1, cols=2)
    t_ttd.autofit = False
    t_ttd.columns[0].width = Mm(80); t_ttd.columns[1].width = Mm(90)
    c_kiri = t_ttd.cell(0, 0)
    c_kiri.add_paragraph("\n\nPemegang KKPR/Wakilnya").alignment = WD_ALIGN_PARAGRAPH.CENTER
    c_kiri.add_paragraph("\n\n\n\n(.................................................)").alignment = WD_ALIGN_PARAGRAPH.CENTER
    c_kanan = t_ttd.cell(0, 1)
    c_kanan.add_paragraph("Kepala Bidang\nPengendalian dan Pengawasan\nDinas Pertanahan dan Tata Ruang\n( Kundha Niti Mandala Sarta Tata Sasana )").alignment = WD_ALIGN_PARAGRAPH.CENTER
    c_kanan.add_paragraph("\n\n")
    p_nama = c_kanan.add_paragraph("(Arif Amrullah, M.T., M.Sc)"); p_nama.runs[0].bold = True; p_nama.alignment = WD_ALIGN_PARAGRAPH.CENTER
    c_kanan.add_paragraph("NIP. 197510132005011007").alignment = WD_ALIGN_PARAGRAPH.CENTER

    return doc

# =======================================================================
# ROUTE API
# =======================================================================

@app.route("/api/cek_kepatuhan", methods=["POST"])
def api_cek_kepatuhan():
    data = request.json
    hasil = proses_cek_kepatuhan(data)
    if "error" in hasil: return jsonify(hasil), 400
    return jsonify(hasil)

@app.route("/api/get_rules", methods=["POST"])
def api_get_rules():
    try:
        data = request.json
        swp = data.get('swpPilihan')
        zona = data.get('zonaPilihan')
        sub = data.get('subZonaPilihan')
        luas = data.get('luasPersilPilihan')
        
        swp_rules = ATURAN_LENGKAP_SWP.get(swp, ATURAN_LENGKAP_SWP.get("DEFAULT_PLACEHOLDER", {}))
        zona_rules = swp_rules.get(zona, ATURAN_LENGKAP_SWP.get("DEFAULT_PLACEHOLDER", {}).get(zona, {}))
        
        kunci = sub if (sub and sub in zona_rules) else list(zona_rules.keys())[0] if zona_rules else None
        
        if not kunci: return jsonify({"error": "Rule not found"}), 404
        
        aturan = zona_rules.get(kunci, {}).get(luas)
        if not aturan: return jsonify({"error": "Size rule not found"}), 404
        
        return jsonify({ "kdbMaks": aturan[0], "klbMaks": aturan[1], "kdhMin": aturan[2] })
    except Exception as e:
        return jsonify({"error": str(e)}), 500

@app.route("/api/export_word", methods=["POST"])
def api_export_word():
    try:
        data = request.json
        file_type = data.get('fileType')
        hasil = proses_cek_kepatuhan(data)
        if "error" in hasil: return jsonify(hasil), 400
        
        if file_type == 'PMP':
            doc = create_pmp_doc(data, hasil)
            filename = f"Rekomendasi_PMP_{get_data(data, 'namaPemohon')}.docx"
        elif file_type == 'IKKPR':
            doc = create_ikkpr_doc(data, hasil)
            filename = f"Rekomendasi_KKPR_{get_data(data, 'namaPemohon')}.docx"
        elif file_type == 'BA':  # <-- TAMBAHAN UNTUK BA
            doc = create_ba_doc(data, hasil)
            filename = f"BA_Pemeriksaan_{get_data(data, 'namaPemohon')}.docx"
        else:
            return jsonify({"error": "Invalid file type"}), 400
        
        mem_file = BytesIO()
        doc.save(mem_file)
        mem_file.seek(0)
        
        return send_file(mem_file, as_attachment=True, download_name=filename, mimetype='application/vnd.openxmlformats-officedocument.wordprocessingml.document')

    except Exception as e:
        return jsonify({"error": f"Generate failed: {str(e)}"}), 500

@app.route("/api/get_subzonas", methods=["GET"])
def api_get_subzonas():
    swp = request.args.get('swp')
    zona = request.args.get('zona')
    swp_rules = ATURAN_LENGKAP_SWP.get(swp, ATURAN_LENGKAP_SWP.get("DEFAULT_PLACEHOLDER", {}))
    zona_rules = swp_rules.get(zona, ATURAN_LENGKAP_SWP.get("DEFAULT_PLACEHOLDER", {}).get(zona, {}))
    return jsonify(list(zona_rules.keys()))

if __name__ == "__main__":
    print("Server berjalan di http://localhost:5000")
    app.run(debug=True, port=5000)